# issue GitHubActions「project全体を入力とし、なんらかのtextを生成する（生成方針は今後自由に変更すればよい）」を、agentに生成させるのを試す #4
[issues #4](https://github.com/cat2151/tonejs-mml-to-json/issues/4)

# issueの目的
- 好奇心。現状のLLMだとどれくらいできるか。
  - 想定。力不足。高度なことをさせるには、ハルシネーションが多く実用にならない。
    - 対策。ゆるく始める。ハルシネーションの出ない範囲の軽い利用で割り切る。
      - 作業優先度と作業負荷の許す範囲で、次第に高度なことを試す。

# prompt
- GitHub Actionsを使った、テキスト生成scriptを検討し、設計書を書いてください。実装はしないで。
- script機能は、Project全体を参照し、テキスト生成することです。
- テキスト生成にはGeminiを用います。
  - README.ja.mdの英語翻訳機能を既にGitHub Actionsで使っているので、参考にします。
- デイリーで日本時間の07:00に起動し、過去24時間以内にuserからのcommit pushがあった場合のみ、テキスト生成してください。
  - ※でないと、userが多忙でprojectから距離をおいているときも継続的にテキストが生成されて蓄積し、userの認知負荷になってしまうので
  - GitHub Actionsによるcommit pushは除外してください
    - ※でないと、userが何もしていないのに毎日GitHub Actionsによるテキスト生成が行われてしまうので
- テキスト生成用のプロンプトは、promptファイルに切り分け、それを編集することで生成方針をいつでも自由に変更できるように。
- promptファイルのデフォルト内容：
```
- 生成するもの：
  - projectを3行で要約する
  - 現在openされているissuesを3行で要約する
  - 次の一手の候補を3つlistする
  - 次の一手の候補3つそれぞれについて、極力小さく分解して、その最初の小さな一歩を書く
- 生成しないもの：
  - 「今日のissue目標」などuserに提案するもの
    - ハルシネーションの温床なので生成しない
  - ハルシネーションしそうなものは生成しない（例、無価値なtaskや新issueを勝手に妄想してそれをuserに提案する等）
```

# 結果
- `.github` と `daily-summaries` に、関連ソースとドキュメントが生成された
- testし、いくつかバグが出て、都度指示して修正させた
- ESM対応。package.jsonで、CommonJSでなくESMが指定されているため、GitHub Actions側で使っているCommonJSがエラー。
  - agentは、GitHub Actions側をESMに実装変更しようとした。
    - だがこの状況においては、cjsにrenameするほうがスムーズであると考える。この状況で、新たなバグを作り込むと、バグ原因切り分けコストが組み合わせ爆発的に増える。それは得策でない。ESM化の実装変更をするなら、後回しがよい。そのように指示して対処した。
- secretを一時的に環境変数に設定し、`pnpm test:summary` する
- testし、いくつかバグが出て、都度指示して修正させた
- test green
- model を `gemini-2.5-flash` にして、生成結果を比較する
  - ※agentが実装した `gemini-1.5-flash` は古くて生成品質が不足であるという認識
  - 結果、大差なかった。
    - どうする？
      - `gemini-2.5-flash` を採用とする。今後の状況やprompt次第で効果を発揮する可能性がある、と判断する。
- 状況
  - 最低限の実装ができたと判断し、 #4 としてはcloseする。
  - 今後ドッグフーディングを進め、課題が出たら、適宜、新たにissue起票とする。

# closeとする
