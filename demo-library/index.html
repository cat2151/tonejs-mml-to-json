<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tonejs-mml-to-json - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆ©ç”¨ãƒ‡ãƒ¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .info-box {
            background-color: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info-box h3 {
            margin-top: 0;
            color: #2980b9;
        }
        .example-section {
            margin: 30px 0;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }
        textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        button {
            padding: 12px 24px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:active {
            transform: translateY(1px);
        }
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.5;
        }
        .status {
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
            font-weight: 500;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        code {
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "web-tree-sitter": "../dist/web-tree-sitter.js",
        "tonejs-mml-to-json": "../dist/index.js"
      }
    }
    </script>
</head>
<body>
    <h1>ğŸ“¦ tonejs-mml-to-json - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆ©ç”¨ãƒ‡ãƒ¢</h1>
    
    <div class="info-box">
        <h3>ğŸ’¡ ã“ã®ãƒ‡ãƒ¢ã«ã¤ã„ã¦</h3>
        <p>ã“ã®ãƒ‡ãƒ¢ã¯ã€<strong>tonejs-mml-to-json</strong> ã‚’ npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ GitHub ã‹ã‚‰ç›´æ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>
        <p>ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã®ã§ã¯ãªãã€<code>npm install</code> ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹æ¨™æº–çš„ãªæ–¹æ³•ã§ã™ã€‚</p>
    </div>
    
    <div id="status" class="status info">
        WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ä¸­...
    </div>
    
    <div class="example-section">
        <h2>ğŸµ ä¾‹1: MMLã‚’JSONã«å¤‰æ›</h2>
        <p>ä»¥ä¸‹ã«MMLã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€ã€Œå¤‰æ›ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨JSONå‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        
        <label for="mmlInput">MMLå…¥åŠ›:</label>
        <textarea id="mmlInput">o4 l16 e f g+ a b a g+ f e8. &lt;e8. &gt;e8</textarea>
        
        <button onclick="convertMML()">å¤‰æ›</button>
        
        <div style="margin-top: 20px;">
            <label>JSONå‡ºåŠ›:</label>
            <pre id="jsonOutput">// JSONå‡ºåŠ›ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</pre>
        </div>
    </div>
    
    <div class="example-section">
        <h2>ğŸ”„ ä¾‹2: 2æ®µéšå¤‰æ›ï¼ˆMML â†’ AST â†’ JSONï¼‰</h2>
        <p>MMLã‚’ASTã«å¤‰æ›ã—ã€ã•ã‚‰ã«ASTã‚’JSONã«å¤‰æ›ã—ã¾ã™ã€‚</p>
        
        <label for="mmlInput2">MMLå…¥åŠ›:</label>
        <textarea id="mmlInput2">o4 l16 c d e f g</textarea>
        
        <button onclick="convertToAST()">ASTã«å¤‰æ›</button>
        <button onclick="convertASTToJSON()">ASTã‚’JSONã«å¤‰æ›</button>
        
        <div style="margin-top: 20px;">
            <label>ASTå‡ºåŠ›:</label>
            <pre id="astOutput">// ASTå‡ºåŠ›ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</pre>
        </div>
        
        <div style="margin-top: 20px;">
            <label>JSONå‡ºåŠ›ï¼ˆASTã‹ã‚‰ï¼‰:</label>
            <pre id="jsonOutput2">// JSONå‡ºåŠ›ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</pre>
        </div>
    </div>
    
    <script type="module">
        (async () => {
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºç”¨ã®è¦ç´ 
            const statusDiv = document.getElementById('status');

            // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
            // import map ã«ã‚ˆã‚Š tonejs-mml-to-json ã¯ ../dist/index.js ã«è§£æ±ºã•ã‚Œã¾ã™
            let initWasm, mml2json, mml2ast, ast2json;

            try {
                const module = await import('tonejs-mml-to-json');
                ({ initWasm, mml2json, mml2ast, ast2json } = module);
            } catch (e) {
                console.error('Failed to load library:', e);
                if (statusDiv) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'âœ— ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (e && e.message ? e.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
                }
                // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãƒ­ãƒ¼ãƒ‰ã§ããªã„å ´åˆã¯ä»¥é™ã®åˆæœŸåŒ–å‡¦ç†ã‚’ä¸­æ–­
                return;
            }

            // 2æ®µéšå¤‰æ›ç”¨ã®ASTä¿å­˜
            let currentAST = null;

            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«WASMåˆæœŸåŒ–
            try {
                await initWasm();
                if (statusDiv) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'âœ“ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆæœŸåŒ–ã«æˆåŠŸã—ã¾ã—ãŸï¼MMLã‚’å¤‰æ›ã™ã‚‹æº–å‚™ãŒã§ãã¦ã„ã¾ã™ã€‚';
                }

                // onclick ãƒãƒ³ãƒ‰ãƒ©ç”¨ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
                window.convertMML = convertMML;
                window.convertToAST = convertToAST;
                window.convertASTToJSON = convertASTToJSON;
            } catch (error) {
                if (statusDiv) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'âœ— ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message;
                }
                console.error(error);
            }

            // å¤‰æ›é–¢æ•°
            function convertMML() {
                const mmlInput = document.getElementById('mmlInput').value;
                const jsonOutput = document.getElementById('jsonOutput');

                try {
                    const result = mml2json(mmlInput);
                    jsonOutput.textContent = JSON.stringify(result, null, 2);
                } catch (error) {
                    jsonOutput.textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
                    console.error(error);
                }
            }

            function convertToAST() {
                const mmlInput = document.getElementById('mmlInput2').value;
                const astOutput = document.getElementById('astOutput');

                try {
                    currentAST = mml2ast(mmlInput);
                    astOutput.textContent = JSON.stringify(currentAST, null, 2);
                } catch (error) {
                    astOutput.textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
                    currentAST = null;
                    console.error(error);
                }
            }

            function convertASTToJSON() {
                const jsonOutput = document.getElementById('jsonOutput2');

                if (!currentAST) {
                    jsonOutput.textContent = 'ã‚¨ãƒ©ãƒ¼: å…ˆã«MMLã‚’ASTã«å¤‰æ›ã—ã¦ãã ã•ã„ï¼';
                    return;
                }

                try {
                    const result = ast2json(currentAST);
                    jsonOutput.textContent = JSON.stringify(result, null, 2);
                } catch (error) {
                    jsonOutput.textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
                    console.error(error);
                }
            }
        })().catch((error) => {
            const statusDiv = document.getElementById('status');
            if (statusDiv) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âœ— äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message;
            }
            console.error(error);
        });
    </script>
</body>
</html>
